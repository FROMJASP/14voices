# 14voices Project Notes

## Payload CMS Custom Login Page

### Overview
This project uses a custom animated login page for Payload CMS admin panel instead of the default Payload login.

### Key Components
- **BeforeLogin Component**: `/src/components/admin/BeforeLogin.tsx`
  - Main component that replaces Payload's default login
  - Configured in `payload.config.ts` under `admin.components.beforeLogin`
  
- **Login Sub-components**: `/src/components/admin/login/`
  - `BackgroundBeams.tsx` - Animated background effects
  - `FloatingLabelInput.tsx` - Custom input fields with floating labels
  - `SplitTextLogo.tsx` - Animated "Fourteen Voices" logo
  - `StarBorderButton.tsx` - Animated submit button
  - `ForgotPassword.tsx` - Forgot password page
  - `ResetPassword.tsx` - Reset password page

### Development vs Production ImportMap

**CRITICAL**: Payload CMS uses an importMap to load custom components. This works differently in development vs production:

#### Development
- Payload dynamically generates the importMap
- Automatically includes all custom components
- No manual configuration needed

#### Production (Vercel)
- Uses a **static** importMap generated by `/scripts/generate-importmap.js`
- This script runs during build: `npm run build:vercel`
- **MUST manually update** this script when adding new admin components

### How to Add New Admin Components

1. Create your component in `/src/components/admin/`
2. Add it to `payload.config.ts`
3. **IMPORTANT**: Update `/scripts/generate-importmap.js`:
   ```javascript
   // Add import at the top
   import { default as default_[hash] } from '../../../components/admin/YourComponent'
   
   // Add to importMap object
   "./components/admin/YourComponent#default": default_[hash],
   ```

### Common Issues

#### Custom components not showing in production
- **Symptom**: Component works locally but shows default Payload UI in production
- **Cause**: Component not included in static importMap
- **Fix**: Update `generate-importmap.js` as shown above

#### Build errors related to types
- Motion/Framer Motion animations may need `as const` assertions
- Payload MetaConfig only accepts specific properties (use `openGraph.images` not `ogImage`)

### Authentication Flow
1. Login page at `/admin`
2. Forgot password at `/admin/forgot-password`
3. Reset password at `/admin/reset-password?token=xxx`
4. All use Next.js `<Link>` components for navigation
5. Custom password reset email template in `/src/collections/Users.ts`

### Styling Notes
- Uses inline CSS in components to ensure styles load in Payload's context
- Dark theme with glassmorphism effects
- All animations use `motion` library (not framer-motion)
- Copyright shows "IAM Studios" not "Fourteen Voices"

### Testing
Always test custom admin components with:
```bash
# Generate static importMap
node scripts/generate-importmap.js

# Run production build
npm run build

# Or test Vercel build specifically
npm run build:vercel
```